{% extends 'base.html.twig' %}

{% block title %}Lista uczestników szkolenia {{ app.request.get('onboardingTraining').training.name }}{% endblock %}

{% block stylesheets %}
    <link href="{{ asset('assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.css') }}" rel="stylesheet">
{% endblock %}

{% block body %}
    <div class="page-wrapper">
        <div class="row page-titles">
            <div class="col-md-9 col-12 align-self-center">
                <h3 class="text-themecolor mb-0">Lista uczestników
                    szkolenia {{ app.request.get('onboardingTraining').training.name }}</h3>
            </div>
            <div class="col-md-3 col-12 align-self-center d-none d-md-block">
                <div class="d-flex justify-content-end">
                    <form action="{{ path('presence_participants_generate_xls', {onboardingTraining: app.request.get('onboardingTraining').id}) }}" method="post">
                        <button type="submit" class="btn waves-effect waves-light btn-info">Pobierz raport</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                {% if app.request.get('onboardingTraining').isTypePresence %}
                                    <form id="frm-example"
                                          action="{{ path('participants_onboarding_training', {onboardingTraining: app.request.get('onboardingTraining').id}) }}"
                                          method="POST">
                                {% endif %}
                                    <div class="modal-body">
                                        <table id="zero_config" class="table table-striped table-bordered">
                                            <thead>
                                            <tr>
                                                {% if app.request.get('onboardingTraining').isTypePresence %}
                                                    <th><input name="select_all" value="1" id="select-all" type="checkbox"/></th>
                                                    <th>Potw. obec. uczestnika</th>
                                                    <th>Potw. obec. trenera</th>
                                                {% endif %}
                                                <th>Imię i nazwisko</th>
                                                <th>Obszar</th>
                                                <th>Przełożony</th>
                                                <th>Data zaliczenia</th>
                                                {% if app.request.get('onboardingTraining').isTypeTest %}
                                                    <th>Wynik</th>
                                                {% endif %}
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for user in users %}
                                                <tr>
                                                    {% if app.request.get('onboardingTraining').isTypePresence %}
                                                        <td>{{ user.id }}</td>
                                                        <td>{{ user.userConfirmation }}</td>
                                                        <td>{{ user.coachConfirmation }}</td>
                                                    {% endif %}
                                                    <td>{{ user.fullname }}</td>
                                                    <td>{{ user.department }}</td>
                                                    <td>{{ user.managerFullname }}</td>
                                                    <td>{{ user.date }}</td>
                                                    {% if app.request.get('onboardingTraining').isTypeTest %}
                                                        <td>{{ user.score }}</td>
                                                    {% endif %}
                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                {% if app.request.get('onboardingTraining').isTypePresence %}
                                        <div class="modal-footer justify-content-between">
                                            <h6>{{ app.request.get('onboardingTraining').training.trainerInfo }}</h6>
                                            <div>
                                                <a class="btn btn-dark"
                                                   href="{{ path('onboarding_training_show', {onboardingTraining: app.request.get('onboardingTraining').id}) }}">Anuluj</a>
                                                <button type="submit" class="btn btn-info">Zapisz</button>
                                            </div>
                                        </div>
                                    </form>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {{ parent() }}
    </div>
{% endblock %}


{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('assets/libs/datatables/media/js/jquery.dataTables.min.js') }}"></script>
    <script src="{{ asset('assets/js/pages/datatable/custom-datatable.js') }}"></script>

    {% if app.user in app.request.get('onboardingTraining').coaches or is_granted('coaching')  %}
        <script>
            $(document).ready(function () {
                var table = $('#zero_config').DataTable({
                    language: {
                        emptyTable: "Brak wyników",
                        infoEmpty: "Brak wyników",
                        zeroRecords: "Brak wyników",
                        lengthMenu: "_MENU_",
                        search: "  ",
                        sSearchPlaceholder: "Wyszukaj...",
                        info: "Wyświetlanych jest _START_ do _END_ z _TOTAL_ wyników", sInfoFiltered:"(wyfiltrowane z _MAX_ wszystkich wpisów)",
                        paginate: {
                            "next": " >",
                            "previous": "< "
                        }
                    },
                {% if app.request.get('onboardingTraining').isTypePresence %}
                    'columnDefs': [{
                        'targets': 0,
                        'searchable': false,
                        'orderable': false,
                        'className': 'dt-body-center',
                        'render': function (data, type, full, meta) {
                            return '<input type="checkbox" name="id[]" value="' + $('<div/>').text(data).html() + '">';
                        }
                    }],
                    'order': [[3, 'asc']]
                {% endif %}
                });

                {% if app.request.get('onboardingTraining').isTypePresence %}
                    $('#select-all').on('click', function () {
                        var rows = table.rows({'search': 'applied'}).nodes();
                        $('input[type="checkbox"]', rows).prop('checked', this.checked);
                    });

                    $('#zero_config tbody').on('change', 'input[type="checkbox"]', function () {
                        if (!this.checked) {
                            var el = $('#select-all').get(0);
                            if (el && el.checked && ('indeterminate' in el)) {
                                el.indeterminate = true;
                            }
                        }
                    });
                {% endif %}
            });
        </script>
    {% endif %}
{% endblock %}